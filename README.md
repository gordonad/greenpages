Eclipse Virgo GreenPages Demo
=============================
### [This Repository: https://github.com/gordonad/greenpages](https://github.com/gordonad/greenpages "Greenpages")

### This project is a Spring Maven project demonstrating OSGi application configuration for deployment on Eclipse Virgo.

- [Eclipse Virgo](http://www.eclipse.org/virgo/ "Virgo")
- [Virgo Samples](http://www.eclipse.org/virgo/samples/ "Samples")


Changes
-------
- greenpages-parent-solution pom.xml
- Spring version 3.0.7 and surefire plugin to use corresponding spring instrument version
- Dependencies versions specified in dependencyManagement section
- Fixed Bundlor configuration
- Corrected inconsistencies between _template.mf_ files
- Builds in Maven 3
- Tested in Virgo 3.0.2.RELEASE
- Does not work in 3.5.0.M3 - unable to find database driver!


TODO
----
- Update to Spring 3.1.1
- Update slf4j to 1.6.4
- Update logback to 1.0.0
- Provide DB connection for MySQL/MariaDB
- JPA 2.0.0
- EclipseLink 2.0.0(?)
- Maven Deploy to $VWS_HOME/pickup directory


Project Layout
--------------
- parent - Top level of Maven project
- web - Web Application
- jpa - Persistence Bundle
- db - Database Configuration
- app - application services
- greenpages - PAR creation


### Structure
- greenpages-app-build _(pom w/ modules)_
  - -> parent _(pom)_
  - -> greenpages.db _(jar)_
  - -> greenpages.app _(jar)_
  - -> greenpages.jpa _(jar)_
  - -> greenpages.web _(war)_
  - -> greenpages _(par)_

### Unidirectional from child to parent (greenpages)
- greenpages _(parent no modules)_
  - -> greenpages-parent
  - -> greenpages-web
  - -> greenpages-jpa
  - -> greenpages-db
  - -> greenpages-app


Virgo Version Configuration
---------------------------
- Virgo Dependencies
  - Created Spring 3.0.7 libd file
  - Added instrument jar to libd file (not sure if necessary)
  - Replaced Spring 3.0.5 jars with 3.0.7 in $VWS_HOME/repository/ext

- Virgo Files
  - $VWS_HOME/configuration/org.eclipse.virgo.kernel.userregion.properties


Application Version Configuration
---------------------------------
- When changing dependencies, ONLY change the template.mf file, Maven Bundlor plugin will automatically generate the correct MANIFEST.MF file
- Updating Application version should be done in all pom.xml and template.mf files


H2 Database
------------
- Database Location: _$USER_HOME/greenpages-db/greenpages_
- Driver JAR: - _$USER_HOME/.m2/repository/com/h2database/com.springsource.org.h2/1.0.71/com.springsource.org.h2-1.0.71.jar_
- Driver URL: - _jdbc:h2:~/greenpages-db/greenpages_
- Port: 9092
- Userid: greenpages
- Password: pass
- Driver Classname: org.h2.Driver


Versions
--------
- Spring: 3.0.7
- EclipseLink: 1.0.0
- Logback 0.9.28
- SLF4j 1.6.1
- JUnit: 4.10.0
- JPA: 1.0.0


Installation
------------
### From _solution_ directory execute:

$ _mvn clean package_


### Deploy:
1. Copy the _solution/target/greenpages*.par_ to _$VWS\_HOME/pickup_ directory
2. Copy the _solution/target/par-provided/*.jar_ to _$VWS\_HOME/repository/usr_ directory


Manifest Creation
-----------------

### Bundlor
- Spring's Bundlor uses the template.mf file to create the manifest in target/classes/META-INF/MANIFEST.MF
- IMPORTANT - The Maven war configuration MUST reference the generated MANIFEST and ignore the one in src/main/webapp/WEB-INF/
- Added Bundle-Description to the template.mf and MANIFEST.MF files.  Once the packaging is done, the resulting packaged MANIFEST.MF files should be have been generated by the Bundlor.
- Changed Bundlor to run in the "process-classes" phase to ensure it is done before packaging to avoid inadvertant overwriting by the static MANIFEST.MF file.


Contact Me
----------
- http://technophile.gordondickens.com
- gordon@gordondickens.com
- @gdickens
  

